<div *ngIf="url == '/home'">
    <app-navbar></app-navbar>
</div>

<div class="container-fluid bg-white main" [ngClass]="{'width': url == '/home'}" style="margin-top: 1em; margin-bottom: 5em; overflow: hidden;">
    <br>
    <div class="container-fluid p-2 border bg-light" style="box-shadow: 0px 0px 10px lightgray; margin-bottom: 1em;"
        *ngIf="url == '/profile' || url == '/home'">
        <div class="d-flex align-items-center justify-content-center flex-nowrap">
            <div class="w-25 m-2 d-flex justify-content-center">
                <img routerLink="/profile"
                    [src]="currentUser == null ? 'https://wallpaperaccess.com/full/1556621.jpg' : currentUser.profileImg"
                    class="point img-shrink">
            </div>
            <div class="container-fluid">
                <textarea class="form-control form-control-sm" style="height: 8em;" placeholder="Share your thoughts."
                    [(ngModel)]="post.description"></textarea>
            </div>
        </div>
        <div class="d-flex align-items-center justify-content-center flex-nowrap">
            <div class="container-fluid">
                <textarea hidden type="text" class="form-control" id="imageuri" required name="imageuri"
                    [(ngModel)]="post.imageUrl"></textarea>
                <button class="btn btn-info d-flex flex-col p-1 m-1 align-items-center justify-content-center w-100"
                    onclick="openWidget('imageuri', null)" id="upload_widget">
                    <span class="material-symbols-outlined p-1">
                        photo_camera
                    </span>
                    OR
                    <span class="material-symbols-outlined p-1">
                        video_camera_front
                    </span>
                </button>
            </div>
            <div class="container-fluid">
                <button class="btn btn-success w-100 m-1" (click)="addPost();"
                    [disabled]="!post.description.trim()">POST</button>
            </div>
        </div>
    </div>
    <p class="d-flex flex-column justify-content-center align-items-center"
    style="font-size: small; font-weight: bold;" *ngIf="posts.length == 0">Not much going on
        <span class="material-symbols-outlined p-1 text-info" style="font-size: 50px;">
            cabin
        </span>
    </p>
    <div class="container-fluid p-1 btn border bg-white d-flex flex-column"
        style="box-shadow: 0px 0px 10px lightgray; margin-top: 1em; margin-bottom: 1em; width: 90%;"
        *ngFor="let post of posts | slice:0:scrollCount;">
        <div class="d-flex p-1 m-0" style="border-bottom: 1px solid gray;">
            <div class="d-flex justify-content-center">
                <img [src]="post.user.profileImg" style="border-radius: 50%; width: 6em; height: 6em;" class="point"
                    (click)="viewUser(post)">
            </div>
            <div class="container-fluid" style="text-align: left; padding-left: 1em;">
                <div>
                    <a class="hover-a" (click)="viewUser(post)">{{ post.user.firstName + " " +
                        post.user.lastName }}
                        <br>{{ formatDate(post.date) }}</a>
                </div>
            </div>
        </div>
        <div class="row" style="text-align: left; padding: 0.5em 0em 0.5em 2em;">
            <div class="col-12">
                <p>{{ post.description }}</p>
            </div>
        </div>
        <div class="row">
            <div [hidden]="post.imageUrl.trim() == ''">
                <div class="col-12"
                    [hidden]="!(post.imageUrl.endsWith('.webp')) && !(post.imageUrl.endsWith('.gif')) &&
                    !(post.imageUrl.endsWith('.jpeg')) && !(post.imageUrl.endsWith('.png')) && !(post.imageUrl.endsWith('.jpg'))">
                    <img [src]="post.imageUrl" style="width: 100%;">
                </div>
                <div class="col-12"
                    [hidden]="!(post.imageUrl.endsWith('.mov')) && !(post.imageUrl.endsWith('.webm')) && !(post.imageUrl.endsWith('.mp4'))">
                    <video controls class="w-100" [src]="post.imageUrl">
                    </video>
                </div>
            </div>
            <a class="container-fluid" style="text-align: right; text-decoration: none; cursor:default;">
                {{ post.likes }}<span class="material-symbols-outlined text-success" style="font-size: medium;">
                    thumb_up
                </span>
                {{ post.dislikes }}<span class="material-symbols-outlined text-danger" style="font-size: medium;">
                    thumb_down
                </span>
                {{ post.shares }}<span class="material-symbols-outlined text-info" style="font-size: medium;">
                    share
                </span>
            </a>
        </div>
        <div class="container-fluid d-flex justify-content-center align-items-center border-top" style="margin: 0.2em 0em 0em 0em;">
            <div class="container-fluid p-1 m-0">
                <button class="container-fluid btn comment" (click)="displayCommentBox(post)"
                    [ngClass]="{'comment-selected': post.showCommentBox}">
                    <span class="material-symbols-outlined">
                        comment
                    </span>
                </button>
            </div>
            <div class="container-fluid p-1 m-0">
                <button class="container-fluid btn like"
                    (click)="post.isLiked = !post.isLiked; post.isDisliked = false; updatePost(post, $event)"
                    [ngClass]="{'like-pressed': post.isLiked}" value="like">
                    <span class="material-symbols-outlined">
                        thumb_up
                    </span>
                </button>
            </div>
            <div class="container-fluid p-1 m-0">
                <button class="container-fluid btn dislike"
                    (click)="post.isDisliked = !post.isDisliked; post.isLiked = false; updatePost(post, $event)"
                    [ngClass]="{'dislike-pressed': post.isDisliked}" value="dislike">
                    <span class="material-symbols-outlined">
                        thumb_down
                    </span>
                </button>
            </div>
            <div class="container-fluid p-1 m-0">
                <button class="container-fluid btn share">
                    <span class="material-symbols-outlined">
                        share
                    </span>
                </button>
            </div>
        </div>
        <div class="container-fluid d-flex flex-nowrap align-items-center">
            <textarea class="container-fluid form-control form-control-sm"
                [ngClass]="{'show-comment-box':post.showCommentBox, 'hide-comment-box': !post.showCommentBox}"
                [placeholder]='"Comment on " + post.user.firstName + "&#39;"+"s post!"'
                [(ngModel)]="comment"></textarea>
            <button class="btn share m-1" (click)="postComment(post, comment)"
                [ngClass]="{'show-comment-box':post.showCommentBox, 'hide-comment-box': !post.showCommentBox}"
                [disabled]="!comment.trim()" (click)="comment = ''; changeIcon()">
                <span class="material-symbols-outlined">
                    {{ sendIcon }}
                </span>
            </button>
            <b *ngIf="sendIcon == 'check'" class="text-success p-0 m-0 nav-link">Sent!</b>
        </div>
        <a class="nav-link p-1" (click)="displayComments(post)" style="text-align: right;">{{ post.showComments ? "hide"
            : "show" }} comments({{ getCommentsCount(post.postId) }})</a>
        <button class="container-fluid btn" style="overflow-y: scroll;"
            [ngClass]="{'show-slider': post.showComments, 'hide-slider': !post.showComments}">
            <div class="btn shadow-none bg-light container-fluid p-0 border rounded" style="margin: 1em 1em 0em 0em;"
                *ngFor="let comment of getCommentsByPost(post.postId)">
                <div class="d-flex p-1 m-0">
                    <div class="d-flex justify-content-center">
                        <img [src]="comment.user.profileImg" style="border-radius: 50%; width: 4em; height: 4em;"
                            class="point" (click)="viewUser(comment)">
                    </div>
                    <div class="container-fluid p-0 m-0" style="text-align: left;">
                        <a class="nav-link" style="padding-left: 1em;" (click)="viewUser(comment)">{{
                            comment.user.firstName + " " +
                            comment.user.lastName }}
                            <br>{{ formatDate(comment.commentDate) }}</a>
                    </div>
                </div>
                <div class="row p-2">
                    <div class="col-10" style="text-align: left; overflow-wrap:break-word;">
                        <p>{{ comment.comment }}</p>
                    </div>
                    <div class="">
                        <button class="btn like">
                            <span class="material-symbols-outlined">
                                thumb_up
                            </span>
                        </button>
                        <button class="btn dislike">
                            <span class="material-symbols-outlined">
                                thumb_down
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </button>
    </div>
</div>